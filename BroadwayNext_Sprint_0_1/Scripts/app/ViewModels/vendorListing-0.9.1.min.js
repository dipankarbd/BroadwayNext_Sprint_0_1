var bn=bn||{};bn.Insurance=function(n){this.Exists=n.Exists,this.VendorInsuranceID=ko.observable(n.VendorInsuranceID),this.VendorID=ko.observable(n.VendorID),this.InsuranceType=ko.observable(n.InsuranceTypeID),this.InsuranceTypeName=ko.observable(n.InsuranceTypeName),this.InsuranceName=ko.observable(n.InsuranceName).extend({editable:{scope:"Insurance"}}),this.Policynum=ko.observable(n.Policynum).extend({editable:{scope:"Insurance"}}),this.ExpiryDate=ko.observable(n.ExpiryDate).extend({editable:{scope:"Insurance"}}),n.ExpiryDate&&(this.ExpiryDate.formatted=moment(n.ExpiryDate).format("MM/DD/YYYY")),this.AdditionalInsured=ko.observable(n.AdditionalInsured).extend({editable:{scope:"Insurance"}}),this.Not_onFile=ko.observable(n.Not_onFile).extend({editable:{scope:"Insurance"}}),this.InsuranceNotRequired=ko.observable(n.InsuranceNotRequired).extend({editable:{scope:"Insurance"}}),this.NotRequiredReason=ko.observable(n.NotRequiredReason)},bn.RemitTo=function(n){this.VendorRemitToID=ko.observable(n.VendorRemitToID),this.VendorID=ko.observable(n.VendorID),this.Company=ko.observable(n.Company),this.RemitType=ko.observable(n.RemitType),this.Address1=ko.observable(n.Address1),this.Address2=ko.observable(n.Address2),this.City=ko.observable(n.City),this.State=ko.observable(n.State),this.Zip=n.zip?ko.observable(n.Zip):ko.observable(),this.Country=ko.observable(n.Country),this.Province=ko.observable(n.Province),this.Phone=ko.observable(n.Phone),this.PhoneExt=ko.observable(n.PhoneExt),this.Contact=ko.observable(n.Contact),this.Email=ko.observable(n.Email),this.InputBy=ko.observable(n.InputBy),this.InputDate=ko.observable(n.InputDate),this.LastModifiedBy=ko.observable(n.LastModifiedBy),this.LastModifiedDate=ko.observable(n.LastModifiedDate),this.Edited=ko.observable(n.Edited)},bn.Vendor=function(n){var t,i;this.VendorID=ko.observable(n.VendorID),this.Vendnum=ko.observable(n.Vendnum),this.Company=ko.observable(n.Company).extend({required:!0}),this.DBA=ko.observable(n.DBA),this.Address1=ko.observable(n.Address1).extend({required:!0}),this.Address2=ko.observable(n.Address2),this.City=ko.observable(n.City).extend({required:!0}),this.State=ko.observable(n.State),this.Zip=ko.observable(n.Zip).extend({required:!0}),this.Country=ko.observable(n.Country),this.Province=ko.observable(n.Province),this.Phone=ko.observable(n.Phone).extend({required:!0}),this.PhoneExt=ko.observable(n.PhoneExt),this.Fax=ko.observable(n.Fax),this.Mobile=ko.observable(n.Mobile),this.Emergency=ko.observable(n.Emergency),this.Contact=ko.observable(n.Contact),this.Email=ko.observable(n.Email),this.AutoEmail=ko.observable(n.AutoEmail),this.Comment=ko.observable(n.Comment),this.VendorType=ko.observable(n.VendorType),this.GLnum=ko.observable(n.GLnum),this.TaxID=ko.observable(n.TaxID),this.NetDays=ko.observable(n.NetDays),this.CheckTax1099=ko.observable(n.CheckTax1099),this.PVA=ko.observable(n.PVA),this.SignedContract=ko.observable(n.SignedContract),this.CreditCardHolder=ko.observable(n.CreditCardHolder),this.W9=ko.observable(n.W9),this.PaymentTerms=ko.observable(n.PaymentTerms),this.CashDiscount=ko.observable(n.CashDiscount),this.PricingYear=ko.observable(n.PricingYear),this.Overallrating=ko.observable(n.Overallrating),this.WebAccessUser=ko.observable(n.WebAccessUser),this.WebAccessPwd=ko.observable(n.WebAccessPwd),this.InputBy=ko.observable(n.InputBy),n.InputDate?(t=moment(n.InputDate).format("MM/DD/YYYY"),this.InputDate=ko.observable(t)):this.InputDate=ko.observable(),this.LastModifiedBy=ko.observable(n.LastModifiedBy),n.LastModifiedDate?(i=moment(n.LastModifiedDate).format("MM/DD/YYYY"),this.LastModifiedDate=ko.observable(i)):this.LastModifiedDate=ko.observable(),this.GradeID=ko.observable(n.GradeID),this.VendorRemitToes=ko.observableArray(n.VendorRemitToes),this.VendorInsurances=ko.observableArray(n.VendorInsurances)},bn.vmVendorList=function(n,t,i){this.infuser.defaults.templateSuffix=".html",this.infuser.defaults.templateUrl="/Templates/VendorListing";var e=this,r=ko.observableArray([]),u=ko.observable(!0),o=ko.observable(!1),f=["USA","Canada"],s=["Reason 1","Reason 2","Reason 3","Reason 4","Reason 5"];return states=ko.observableArray(["AL","CA","NY","WI","MT","MD"]),selectedState=ko.observable(""),_vendorInsTypes=[],pageSize=ko.observable(10),totalPages=ko.observable(0),currentPage=ko.observable(1),totalRows=ko.observable(0),applyMask=function(){},selectedVendor=ko.observable(),selectVendor=function(n){selectedVendor(n),isSelected(!0)},editingVendor=ko.observable(),createVendor=function(){var u=new t.Vendor({}),e=[new t.RemitTo({})],f;u.VendorRemitToes(e),f=[],_vendorInsTypes.length?(f=buildInsurances(_vendorInsTypes),u.VendorInsurances(f),selectedVendor(u),editVendor()):n.when(n.getJSON("/VendorListing/GetInsuranceTypes")).then(function(n){n&&(_vendorInsTypes.push.apply(_vendorInsTypes,n),f=buildInsurances(_vendorInsTypes)),u.VendorInsurances(f),selectedVendor(u),editVendor()})},editVendor=function(){inEditMode(!0),fixTabNavigation(),editingVendor(selectedVendor()),ko.editable.beginEdit("Insurance"),ko.editable(editingVendor()),editingVendor().beginEdit(),applyMask()},cancelEdit=function(){var n=ko.editable.hasChanges("Insurance");editingVendor().rollback(),inEditMode(!1),u(!0),editingVendor(i),fixTabNavigation()},saveDetailsCmd=ko.asyncCommand({execute:function(n){var i=ko.editable.hasChanges("Insurance"),r;i?(r=clearInsurances(editingVendor().VendorInsurances()),editingVendor().VendorInsurances(r)):editingVendor().VendorInsurances([]),editingVendor().commit(),t.ajaxService.updateVendors(editingVendor,onSuccessSaveDetails,onErrorSaveDetails),n()},canExecute:function(n){return!n&&u()}}),onSuccessSaveDetails=function(){toastr.success("Record has been updated successfully","Success"),reloadAndReset(!0)},onErrorSaveDetails=function(){toastr.error("An unexpected error occurred. Please try again","Error"),reloadAndReset(!0)},inEditMode=ko.observable(!1),isSelected=ko.observable(!1),showDetails=function(){return selectedVendor()?!0:(r().length>0&&selectedVendor(r()[0]),!0)},onSuccessLoadVendor=function(i){totalPages(Math.ceil(i.VirtualRowCount/pageSize())),totalRows(i.VirtualRowCount);var f=[],u=n.map(i.Data,function(n){var r=[{}],u;return r=n.VendorRemitToes.length?ko.utils.arrayMap(n.VendorRemitToes,function(n){return new t.RemitTo(n)}):[new t.RemitTo({})],u=[],u=buildInsurances(i.InsuranceTypes,n),n.VendorInsurances=u,n.VendorRemitToes=r,new t.Vendor(n)});return r([]),reloadAndReset(!1),r.push.apply(r,u)},onErrorLoadVendor=function(){toastr.error("An unexpected error occurred. Please try again","Error")},loadInsuranceTypes=function(){n.getJSON("/VendorListing/GetInsuranceTypes",function(n){if(n)return _vendorInsTypes.push.apply(_vendorInsTypes,n)})},loadVendors=function(){var i=n("#searchVendNum").val();t.ajaxService.getVendors({pageSize:pageSize(),currentPage:currentPage(),searchStr:i},onSuccessLoadVendor,onErrorLoadVendor)},deleteVendor=function(){confirm("Are you sure you want to delete this vendor? All other information related to this Vendor will be deleted as well.")&&n.ajax("/vendorlisting/DeleteVendorAll",{data:ko.toJSON({vendorID:selectedVendor().VendorID()}),type:"post",contentType:"application/json",success:function(n){n.Success?toastr.success("Vendor information deleted successfully","Success"):toastr.error("An unexpected error occurred. Please try again","Error"),reloadAndReset(!0)}})},buildInsurances=function(n,i){var r=[];return ko.utils.arrayForEach(n,function(u){var f,o,e;_vendorInsTypes.length<n.length&&_vendorInsTypes.push(u),i&&(f=ko.utils.arrayFirst(i.VendorInsurances,function(n){return n.InsuranceType===u.InsuranceTypeID})),f?(f.Exists=!0,f.InsuranceTypeName=u.InsuranceType,f.InsuranceTypeID=u.InsuranceTypeID,o=new t.Insurance(f),r.push(o)):(e=createEmptyInsurance(u),e.Exists=!1,r.push(e))}),r},createEmptyInsurance=function(n){var i={},r;return i.InsuranceTypeID=n.InsuranceTypeID,i.InsuranceTypeName=n.InsuranceType,r=new t.Insurance(i)},clearInsurances=function(n){return ko.utils.arrayFilter(n,function(n){return n.InsuranceName()&&n.Policynum()})},reloadAndReset=function(n){n&&loadVendors(),selectedVendor(i),selectedVendor.valueHasMutated(),editingVendor(i),isSelected(!1),inEditMode(!1),u(!0),fixTabNavigation()},fixTabNavigation=function(){inEditMode()?(n("#tabstwo li:eq(1) a").tab("show"),n("#tabstwo li a").filter(function(n){return n==0||n>3}).removeAttr("data-toggle")):(n("#tabstwo li a").attr("data-toggle","tab"),n("#tabstwo li:eq(0) a").tab("show"))},{states:states,countries:f,vendors:r,inEditMode:inEditMode,selectVendor:selectVendor,selectedVendor:selectedVendor,isSelected:isSelected,editVendor:editVendor,editingVendor:editingVendor,cancelEdit:cancelEdit,modelIsValid:u,pageSize:pageSize,totalPages:totalPages,currentPage:currentPage,totalRows:totalRows,loadVendors:loadVendors,saveDetailsCmd:saveDetailsCmd,showDetails:showDetails,createVendor:createVendor}}(jQuery,bn),$(function(){$("#tabstwo a").click(function(n){bn.vmVendorList.showDetails(n)}),bn.vmVendorList.selectedVendor.subscribe(function(n){if(n){var t=ko.utils.unwrapObservable(n.VendorID),i=ko.utils.unwrapObservable(n.Vendnum);amplify.publish("VendorSelectionChanged",t,i)}else amplify.publish("VendorSelectionChanged")}),amplify.subscribe("EditVendor",bn.vmVendorList.editVendor)})